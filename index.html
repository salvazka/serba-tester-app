<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Tester App (Warna dan Style Baru)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfigurasi Tailwind untuk warna dan font yang lebih baik -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3b82f6', // blue-500
                        'primary-dark': '#1f2937', // gray-800
                        'accent-red': '#ef4444', // red-500
                        'accent-green': '#10b981', // green-500
                        'light-bg': '#f9fafb', // gray-50
                        'card-bg': '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'custom': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'xl-dark': '0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Menggunakan font Inter dari Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        /* ======================================================
           GLOBAL STYLES
           ====================================================== */
        .tester-content {
            transition: opacity 0.3s ease-in-out;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Styling untuk semua tombol aksi */
        .button-action {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; /* Lebih membulat */
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .button-action:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .button-action:active {
            transform: translateY(1px) scale(0.98);
            box-shadow: none;
        }
        
        /* ======================================================
           TAB NAVIGATION STYLES
           ====================================================== */
        .tab-button {
            transition: all 0.2s ease-in-out;
            border-radius: 0.65rem;
        }
        .tab-button:hover {
            background-color: #eef2ff; /* indigo-50 */
            color: #4f46e5; /* indigo-600 */
        }
        .tab-button.active-tab {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            transform: translateY(-1px);
        }
        .tab-button.active-tab:hover {
            background-color: #4338ca; /* indigo-700 */
            color: white;
        }

        /* ======================================================
           KEYBOARD TESTER STYLES
           ====================================================== */
        .key {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 3rem;
            min-width: 3rem;
            padding: 0 0.5rem;
            margin: 0.25rem;
            background-color: #f3f4f6; /* gray-100 */
            border-radius: 0.5rem;
            border-bottom: 4px solid #d1d5db; /* gray-300 */
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .key.pressed {
            background-color: #10b981; /* accent-green (emerald-500) */
            border-bottom: 4px solid #059669; /* emerald-600 */
            color: white;
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Ukuran tombol khusus */
        .key-tab { width: 4.5rem; }
        .key-caps { width: 5.5rem; }
        .key-shift { width: 8rem; }
        .key-ctrl { width: 4rem; }
        .key-enter { width: 6rem; }
        .key-space { width: 14rem; }
        .key-utility { background-color: #e0e7ff; color: #4338ca; border-bottom: 4px solid #c7d2fe; font-size: 0.75rem;}

        .key.pressed.key-utility {
            background-color: #10b981; 
            border-bottom-color: #059669; 
            color: white;
        }

        /* ======================================================
           SPEED TESTER STYLES
           ====================================================== */
        #gauge-container {
            width: 300px;
            height: 150px;
            position: relative;
            overflow: hidden;
            margin: 2rem auto;
            border-radius: 150px 150px 0 0;
            background-color: #e5e7eb; /* gray-200 */
            box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.1);
        }
        #gauge-arc {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            left: 0;
            /* Arc gradient: Green -> Yellow -> Red (Good -> Average -> Bad) */
            background: conic-gradient(
                #3b82f6 0%,  /* Blue (Excellent) */
                #10b981 33%, /* Green (Good) */
                #f59e0b 66%, /* Yellow (Average) */
                #ef4444 100% /* Red (Poor) */
            );
        }
        #gauge-center {
            width: 280px;
            height: 280px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            bottom: 10px;
            left: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #needle {
            position: absolute;
            bottom: 5px;
            left: 50%;
            width: 4px; /* Lebih tebal */
            height: 145px;
            background-color: #1f2937; /* primary-dark */
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Animasi pegas */
            z-index: 10;
        }
        #speed-readout {
            position: absolute;
            bottom: -5px; /* Sedikit ke bawah */
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            background-color: #f9fafb; /* light-bg */
            padding: 0.5rem 1.25rem;
            border-radius: 0.75rem 0.75rem 0 0;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            border-top: 3px solid #4f46e5; /* indigo-600 */
        }
        
        /* Kartu Hasil Speed Test */
        .result-card {
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }


        /* ======================================================
           MONITOR TESTER STYLES
           ====================================================== */
        
        #monitor-test-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease;
            color: white;
            font-size: 2em;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.9);
            cursor: pointer;
            background-color: black;
            width: 100%; 
            height: 60vh; /* Lebih besar */
            margin: auto;
            border-radius: 0.75rem;
            position: relative; 
            overflow: hidden;
        }
        
        /* Menyesuaikan area tes saat mode layar penuh aktif */
        #monitor-content:fullscreen #monitor-test-area {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border-radius: 0;
            z-index: 9999;
        }
        
        #monitor-test-navigation {
            padding: 1rem;
            background: #f1f5f9; /* blue-gray-100 */
            border-top: 1px solid #e2e8f0; /* blue-gray-200 */
            display: flex;
            flex-wrap: wrap; /* Responsif */
            justify-content: center; 
            gap: 0.5rem;
            border-radius: 0 0 0.75rem 0.75rem;
        }
        
        /* Menyembunyikan navigasi saat fullscreen */
        #monitor-content:fullscreen #monitor-test-navigation {
            display: none !important;
        }

        .monitor-nav-button {
            background-color: #3b82f6; /* primary-blue */
            color: white;
            border: none;
            padding: 10px 18px;
            cursor: pointer;
            border-radius: 0.5rem;
            font-size: 0.9em;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }

        .monitor-nav-button:hover {
            background-color: #2563eb; /* blue-600 */
        }
        
        .monitor-nav-button.fullscreen-btn {
            background-color: #10b981; /* accent-green */
        }
        .monitor-nav-button.fullscreen-btn:hover {
            background-color: #059669; 
        }

        #monitor-test-info {
            font-weight: 700;
            color: #1f2937; 
            padding: 0.5rem 0;
        }
        
        .monitor-black-text {
            color: black;
            text-shadow: none;
        }

        #monitor-gradient-box {
            width: 90%; /* Lebih besar */
            height: 70%; 
            border-radius: 0.5rem;
            background: linear-gradient(to right, 
                #000000, #404040, #808080, #C0C0C0, #FFFFFF); 
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }
        
        #monitor-test-area.color-test #monitor-gradient-box {
            background: linear-gradient(to right, 
                red, #ff7f00, yellow, #80ff00, green, #00ff80, cyan, blue, #8000ff, magenta, red); 
        }
        
        /* ======================================================
           AUDIO TESTER STYLES
           ====================================================== */
        .audio-test-button {
            transition: all 0.2s;
            position: relative;
        }

        .audio-test-button:disabled {
            filter: grayscale(80%);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
        }

        .audio-test-button:not(:disabled):hover {
            transform: translateY(-3px) scale(1.02);
        }

    </style>
</head>
<body class="bg-light-bg min-h-screen p-4 sm:p-8 flex flex-col items-center font-sans">

    <header class="text-center mb-8">
        <div class="inline-flex items-center p-3 bg-white rounded-full shadow-lg mb-2">
             <i data-lucide="zap" class="w-8 h-8 text-primary-blue"></i>
        </div>
        <h1 class="text-4xl font-extrabold text-primary-dark tracking-tight">Serba Tester App</h1>
        <p class="text-gray-500 mt-1">Uji Perangkat Keras dan Koneksi Anda dengan Cepat</p>
    </header>

    <!-- Navigasi Tab Baru dengan Style Lebih Modern -->
    <nav class="flex flex-wrap justify-center space-x-1 p-1 bg-white rounded-2xl shadow-custom max-w-full overflow-x-auto mb-8">
        <button id="keyboard-tab" class="tab-button flex items-center px-4 py-3 text-sm" onclick="setActiveTab('keyboard')">
            <i data-lucide="keyboard" class="w-5 h-5 mr-2"></i> Keyboard
        </button>
        <button id="speed-tab" class="tab-button flex items-center px-4 py-3 text-sm" onclick="setActiveTab('speed')">
            <i data-lucide="gauge" class="w-5 h-5 mr-2"></i> Kecepatan
        </button>
        <button id="audio-tab" class="tab-button flex items-center px-4 py-3 text-sm" onclick="setActiveTab('audio')">
            <i data-lucide="volume-2" class="w-5 h-5 mr-2"></i> Audio
        </button>
        <button id="monitor-tab" class="tab-button flex items-center px-4 py-3 text-sm" onclick="setActiveTab('monitor')">
            <i data-lucide="monitor" class="w-5 h-5 mr-2"></i> Monitor
        </button>
    </nav>

    <!-- Kontainer Konten Utama -->
    <div id="tester-container" class="w-full max-w-5xl mt-4 p-8 bg-card-bg rounded-2xl shadow-xl-dark border border-gray-100">
        
        <!-- ======================================================
             KEYBOARD TESTER CONTENT
             ====================================================== -->
        <div id="keyboard-content" class="tester-content" style="display: none;">
            <h2 class="text-3xl font-bold text-primary-dark mb-6 flex items-center">
                <i data-lucide="keyboard" class="w-7 h-7 mr-3 text-accent-green"></i> Tes Keyboard
            </h2>
            <p class="text-gray-600 mb-8">Tekan tombol di keyboard fisik Anda. Tombol yang berfungsi akan menyala hijau.</p>
            <div id="keyboard-layout" class="flex flex-wrap justify-center p-4 bg-gray-50 rounded-lg shadow-inner">
                
                <!-- Row Fungsi (F1-F12) -->
                <div class="flex w-full justify-center mb-2 gap-1">
                    <span class="key key-utility" data-code="F1">F1</span><span class="key key-utility" data-code="F2">F2</span><span class="key key-utility" data-code="F3">F3</span><span class="key key-utility" data-code="F4">F4</span>
                    <span class="key key-utility ml-4" data-code="F5">F5</span><span class="key key-utility" data-code="F6">F6</span><span class="key key-utility" data-code="F7">F7</span><span class="key key-utility" data-code="F8">F8</span>
                    <span class="key key-utility ml-4" data-code="F9">F9</span><span class="key key-utility" data-code="F10">F10</span><span class="key key-utility" data-code="F11">F11</span><span class="key key-utility" data-code="F12">F12</span>
                </div>
                
                <!-- Row Angka/Simbol (~, 1, 2, ..., Backspace) -->
                <div class="flex w-full justify-center mb-1">
                    <span class="key key-utility" data-code="Backquote">~</span><span class="key" data-code="Digit1">1</span><span class="key" data-code="Digit2">2</span><span class="key" data-code="Digit3">3</span><span class="key" data-code="Digit4">4</span><span class="key" data-code="Digit5">5</span><span class="key" data-code="Digit6">6</span><span class="key" data-code="Digit7">7</span><span class="key" data-code="Digit8">8</span><span class="key" data-code="Digit9">9</span><span class="key" data-code="Digit0">0</span><span class="key" data-code="Minus">-</span><span class="key" data-code="Equal">=</span><span class="key key-enter key-utility" data-code="Backspace">Backspace</span>
                </div>
                
                <!-- Row QWERTY -->
                <div class="flex w-full justify-center mb-1">
                    <span class="key key-tab key-utility" data-code="Tab">Tab</span><span class="key" data-code="KeyQ">Q</span><span class="key" data-code="KeyW">W</span><span class="key" data-code="KeyE">E</span><span class="key" data-code="KeyR">R</span><span class="key" data-code="KeyT">T</span><span class="key" data-code="KeyY">Y</span><span class="key" data-code="KeyU">U</span><span class="key" data-code="KeyI">I</span><span class="key" data-code="KeyO">O</span><span class="key" data-code="KeyP">P</span><span class="key" data-code="BracketLeft">[</span><span class="key" data-code="BracketRight">]</span><span class="key key-utility" data-code="Backslash">\</span>
                </div>
                
                <!-- Row ASDF -->
                <div class="flex w-full justify-center mb-1">
                    <span class="key key-caps key-utility" data-code="CapsLock">Caps Lock</span><span class="key" data-code="KeyA">A</span><span class="key" data-code="KeyS">S</span><span class="key" data-code="KeyD">D</span><span class="key" data-code="KeyF">F</span><span class="key" data-code="KeyG">G</span><span class="key" data-code="KeyH">H</span><span class="key" data-code="KeyJ">J</span><span class="key" data-code="KeyK">K</span><span class="key" data-code="KeyL">L</span><span class="key" data-code="Semicolon">;</span><span class="key" data-code="Quote">'</span><span class="key key-enter key-utility" data-code="Enter">Enter</span>
                </div>
                
                <!-- Row ZXCV -->
                <div class="flex w-full justify-center mb-1">
                    <span class="key key-shift key-utility" data-code="ShiftLeft">Shift</span><span class="key" data-code="KeyZ">Z</span><span class="key" data-code="KeyX">X</span><span class="key" data-code="KeyC">C</span><span class="key" data-code="KeyV">V</span><span class="key" data-code="KeyB">B</span><span class="key" data-code="KeyN">N</span><span class="key" data-code="KeyM">M</span><span class="key" data-code="Comma">,</span><span class="key" data-code="Period">.</span><span class="key" data-code="Slash">/</span><span class="key key-shift key-utility" data-code="ShiftRight">Shift</span>
                </div>
                
                <!-- Row Bawah -->
                <div class="flex w-full justify-center mb-1">
                    <span class="key key-ctrl key-utility" data-code="ControlLeft">Ctrl</span><span class="key key-ctrl key-utility" data-code="MetaLeft">Win</span><span class="key key-ctrl key-utility" data-code="AltLeft">Alt</span>
                    <span class="key key-space key-utility" data-code="Space">Spacebar</span>
                    <span class="key key-ctrl key-utility" data-code="AltRight">Alt</span><span class="key key-ctrl key-utility" data-code="MetaRight">Win</span><span class="key key-ctrl key-utility" data-code="ControlRight">Ctrl</span>
                </div>
                
                <!-- Tombol Navigasi Lain dan Angka -->
                <div class="flex w-full justify-center mt-6 gap-8">
                    <!-- Kelompok Insert/Home -->
                    <div class="grid grid-cols-3 gap-1">
                        <span class="key key-utility" data-code="Insert">Ins</span><span class="key key-utility" data-code="Home">Home</span><span class="key key-utility" data-code="PageUp">PgUp</span>
                        <span class="key key-utility" data-code="Delete">Del</span><span class="key key-utility" data-code="End">End</span><span class="key key-utility" data-code="PageDown">PgDn</span>
                    </div>
                    <!-- Kelompok Panah -->
                    <div class="flex flex-col items-center">
                        <span class="key key-utility" data-code="ArrowUp"><i data-lucide="arrow-up" class="w-4 h-4"></i></span>
                        <div class="flex">
                            <span class="key key-utility" data-code="ArrowLeft"><i data-lucide="arrow-left" class="w-4 h-4"></i></span>
                            <span class="key key-utility" data-code="ArrowDown"><i data-lucide="arrow-down" class="w-4 h-4"></i></span>
                            <span class="key key-utility" data-code="ArrowRight"><i data-lucide="arrow-right" class="w-4 h-4"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="status-message" class="mt-8 text-center text-lg font-semibold text-primary-dark p-4 rounded-xl bg-primary-blue/10 border-2 border-primary-blue/30 shadow-md">
                <span id="key-press-indicator">Menunggu penekanan tombol...</span>
            </div>
        </div>

        <!-- ======================================================
             SPEED TESTER CONTENT
             ====================================================== -->
        <div id="speed-content" class="tester-content" style="display: none;">
            <h2 class="text-3xl font-bold text-primary-dark mb-6 flex items-center">
                <i data-lucide="gauge" class="w-7 h-7 mr-3 text-primary-blue"></i> Tes Kecepatan Internet
            </h2>
            
            <div id="gauge-container">
                <div id="gauge-arc"></div>
                <div id="gauge-center"></div>
                <div id="needle"></div>
                <div id="speed-readout" class="text-2xl font-extrabold text-primary-dark">
                    <span id="current-speed">0.00</span> <span class="text-base font-semibold text-gray-500">Mbps</span>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-around text-center mb-8 gap-4">
                <div class="result-card bg-primary-blue/10 text-primary-blue flex-1">
                    <p class="text-sm text-gray-500 font-medium">PING (ms)</p>
                    <p id="ping-result" class="text-3xl font-extrabold text-primary-blue mt-1">--</p>
                </div>
                <div class="result-card bg-accent-red/10 text-accent-red flex-1">
                    <p class="text-sm text-gray-500 font-medium">DOWNLOAD (Mbps)</p>
                    <p id="download-result" class="text-3xl font-extrabold text-accent-red mt-1">--</p>
                </div>
                <div class="result-card bg-accent-green/10 text-accent-green flex-1">
                    <p class="text-sm text-gray-500 font-medium">UPLOAD (Mbps)</p>
                    <p id="upload-result" class="text-3xl font-extrabold text-accent-green mt-1">--</p>
                </div>
            </div>

            <div class="text-center space-y-6">
                <p id="status-text" class="text-xl font-medium text-gray-700">Siap untuk memulai tes.</p>
                <button id="start-button" onclick="startSpeedTest()" class="button-action bg-primary-blue text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                    <i data-lucide="activity" class="w-6 h-6 mr-3"></i> Mulai Tes
                </button>
                <p class="text-xs text-gray-400">Hasil tes ini adalah simulasi berbasis browser.</p>
            </div>
        </div>

        <!-- ======================================================
             AUDIO TESTER CONTENT
             ====================================================== -->
        <div id="audio-content" class="tester-content p-6" style="display: none;">
            <h2 class="text-3xl font-bold text-primary-dark mb-6 flex items-center">
                <i data-lucide="volume-2" class="w-7 h-7 mr-3 text-accent-red"></i> Tes Speaker
            </h2>
            <p class="text-gray-600 mb-8">Tekan tombol di bawah untuk menguji apakah audio berfungsi dengan benar. <span class="font-semibold">Pastikan volume perangkat Anda cukup tinggi.</span></p>
            
            <div id="speaker-test-controls" class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                <button id="test-left" onclick="startSpeakerTest('left')" class="button-action audio-test-button bg-primary-blue text-white hover:bg-blue-600">
                    <i data-lucide="volume-1" class="w-5 h-5 mr-2"></i> Speaker Kiri
                </button>
                <button id="test-right" onclick="startSpeakerTest('right')" class="button-action audio-test-button bg-accent-red text-white hover:bg-red-600">
                    <i data-lucide="volume-1" class="w-5 h-5 mr-2"></i> Speaker Kanan
                </button>
                <button id="test-stereo" onclick="startSpeakerTest('stereo')" class="button-action audio-test-button bg-accent-green text-white hover:bg-green-600">
                    <i data-lucide="volume-2" class="w-5 h-5 mr-2"></i> Stereo (Kiri & Kanan)
                </button>
            </div>
            
            <div id="test-indicator" class="mt-10 p-5 rounded-xl text-center text-xl font-semibold bg-gray-50 border-2 border-gray-200 shadow-inner">
                <span id="speaker-status" class="text-gray-700">Tekan tombol untuk memulai tes speaker.</span>
            </div>

            <div class="mt-6 text-center">
                <button id="stop-audio" onclick="stopSpeakerTest()" class="button-action bg-gray-500 text-white hover:bg-gray-600" style="display:none;">
                     <i data-lucide="square" class="w-5 h-5 mr-2"></i> Hentikan Tes Audio
                </button>
            </div>
        </div>
        
        <!-- ======================================================
             MONITOR TESTER CONTENT
             ====================================================== -->
        <div id="monitor-content" class="tester-content p-0 overflow-hidden" style="display: none;">
            
            <h2 class="text-3xl font-bold text-primary-dark mb-4 px-6 pt-4 flex items-center">
                <i data-lucide="monitor" class="w-7 h-7 mr-3 text-primary-blue"></i> Tes Monitor (Visual)
            </h2>

            <div id="monitor-test-area">
                <div id="monitor-test-content">Klik atau Tekan Tombol Panah Kanan (‚Üí) untuk memulai!</div>
                <div id="monitor-gradient-box" style="display: none;"></div>
            </div>

            <div id="monitor-test-navigation">
                <button id="monitor-prev-btn" class="monitor-nav-button">‚Üê Sebelumnya</button>
                <span id="monitor-test-info">Persiapan (0/9)</span>
                <button id="monitor-next-btn" class="monitor-nav-button">Selanjutnya ‚Üí</button>
                <button id="monitor-fullscreen-btn" onclick="toggleFullScreen()" class="monitor-nav-button fullscreen-btn flex items-center">
                    <i data-lucide="maximize" class="w-4 h-4 mr-2"></i> Layar Penuh
                </button>
                <button id="monitor-exit-btn" onclick="setActiveTab('keyboard')" class="monitor-nav-button bg-gray-500 hover:bg-gray-600">Selesai</button>
            </div>
            
            <p class="text-sm text-gray-500 text-center mt-2 px-6 pb-2">Gunakan tombol <span class="font-mono bg-gray-200 px-1 rounded">Panah Kanan/Kiri</span> atau <span class="font-mono bg-gray-200 px-1 rounded">klik</span> pada layar untuk navigasi.</p>
        </div>

    </div> 

    <script>
        // ======================================================
        // GLOBAL FUNCTIONS
        // ======================================================

        /** Mengontrol tampilan tab konten */
        function setActiveTab(tabId) {
            const contents = document.querySelectorAll('.tester-content');
            contents.forEach(content => {
                content.style.display = 'none';
            });

            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => {
                tab.classList.remove('active-tab');
                tab.classList.add('text-gray-600');
            });

            // Pastikan keluar dari fullscreen jika beralih tab
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }

            const activeContent = document.getElementById(tabId + '-content');
            if (activeContent) {
                activeContent.style.display = 'block';
            }
            
            const activeTabButton = document.getElementById(tabId + '-tab');
            if (activeTabButton) {
                activeTabButton.classList.add('active-tab');
                activeTabButton.classList.remove('text-gray-600');
            }

            // PENTING: Hentikan tes audio saat beralih tab
            if (tabId !== 'audio') {
                stopSpeakerTest();
            }
            
            // PENTING: Inisialisasi tes monitor saat beralih ke sana
            if (tabId === 'monitor') {
                monitorInitTest();
            }
            
            // PENTING: Inisialisasi tes kecepatan saat beralih ke sana
            if (tabId === 'speed') {
                initializeSpeedTestElements();
            }
        }

        // ======================================================
        // KEYBOARD TESTER FUNCTIONS
        // ======================================================

        const keyMap = {};
        document.querySelectorAll('#keyboard-layout .key').forEach(keyEl => {
            keyMap[keyEl.getAttribute('data-code')] = keyEl;
        });

        document.addEventListener('keydown', (e) => {
            // Logika Keyboard Test
            if (document.getElementById('keyboard-content').style.display !== 'none') {
                const keyEl = keyMap[e.code];
                if (keyEl && !keyEl.classList.contains('pressed')) {
                    keyEl.classList.add('pressed');
                    document.getElementById('key-press-indicator').textContent = `Tombol ditekan: ${e.code} (${e.key})`;
                }
            }
            
            // Logika Monitor Test
            if (document.getElementById('monitor-content').style.display !== 'none') {
                 if (e.key === 'ArrowRight' || e.key === ' ') {
                    e.preventDefault();
                    monitorNextTest();
                } else if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    monitorPrevTest();
                } else if (e.key === 'Escape') {
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                        e.preventDefault(); 
                    } else {
                        // Tidak kembali ke keyboard, cukup sembunyikan untuk menghindari navigasi
                        // setActiveTab('keyboard'); 
                        // e.preventDefault();
                    }
                }
            }
        });

        document.addEventListener('keyup', (e) => {
             if (document.getElementById('keyboard-content').style.display !== 'none') {
                const keyEl = keyMap[e.code];
                if (keyEl && keyEl.classList.contains('pressed')) {
                    keyEl.classList.remove('pressed');
                }
            }
        });

        
        // ======================================================
        // SPEED TESTER CORE LOGIC (SIMULATION)
        // ======================================================
        
        const TEST_DURATION_MS = 2000; // Durasi tes per fase (ping, download, upload)
        
        let statusText;
        let speedDisplay; 
        let needle;       
        let startButton;

        function initializeSpeedTestElements() {
            statusText = document.getElementById('status-text');
            speedDisplay = document.getElementById('current-speed');
            needle = document.getElementById('needle');
            startButton = document.getElementById('start-button');
            
            document.getElementById('ping-result').textContent = '--';
            document.getElementById('download-result').textContent = '--';
            document.getElementById('upload-result').textContent = '--';
            if (speedDisplay) speedDisplay.textContent = '0.00';
            
            if (needle) {
                needle.style.transform = 'translateX(-50%) rotate(-90deg)';
            }
            
            if (statusText) statusText.textContent = "Siap untuk memulai tes.";
            if (startButton) {
                startButton.innerHTML = '<i data-lucide="activity" class="w-6 h-6 mr-3"></i> Mulai Tes';
                startButton.disabled = false;
            }
            lucide.createIcons(); // Re-render icon
        }

        function speedToAngle(speedMbps) {
            // Skala gauge hingga 100 Mbps (maksimal)
            const maxSpeed = 100; 
            const normalizedSpeed = Math.min(speedMbps, maxSpeed);
            // Rotasi dari -90 derajat (0 Mbps) hingga 90 derajat (100 Mbps)
            const degrees = (normalizedSpeed / maxSpeed) * 180;
            return degrees - 90; 
        }

        function formatSpeed(speed) {
            return speed.toFixed(2);
        }

        async function measurePing() {
            if (statusText) statusText.textContent = "Menguji Latensi (Ping)...";
            if (needle) needle.style.transform = 'translateX(-50%) rotate(-90deg)';
            if (speedDisplay) speedDisplay.textContent = '0.00';
            
            const simulatedPings = [35, 42, 38, 51, 40]; // Simulasi hasil ping
            await new Promise(resolve => setTimeout(resolve, TEST_DURATION_MS));
            
            const avgLatency = simulatedPings.reduce((a, b) => a + b, 0) / simulatedPings.length;
            return avgLatency;
        }

        async function measureThroughput(type) {
            if (statusText) {
                statusText.textContent = `${type === 'download' ? 'Mengukur Kecepatan Download' : 'Mengukur Kecepatan Upload'}...`;
            }
            
            let simulatedSpeed = 0; 
            const updateInterval = 50; 
            const startTime = performance.now();
            
            return new Promise(resolve => {
                const animationLoop = setInterval(() => {
                    const elapsedTime = performance.now() - startTime;
                    if (elapsedTime > TEST_DURATION_MS) {
                        clearInterval(animationLoop);
                        
                        // Nilai Akhir Simulasi (contoh: Download max 65 Mbps, Upload max 35 Mbps)
                        const finalSpeed = type === 'download' 
                            ? (65 + Math.random() * 10)
                            : (35 + Math.random() * 5);
                            
                        const angle = speedToAngle(finalSpeed);
                        if (needle) needle.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                        if (speedDisplay) speedDisplay.textContent = `${formatSpeed(finalSpeed)}`;
                        
                        resolve(finalSpeed);
                        return;
                    }

                    const progress = elapsedTime / TEST_DURATION_MS;
                    const maxSimulatedSpeed = type === 'download' ? 70 : 40; 
                    
                    // Percepatan simulasi kecepatan yang lebih halus
                    const targetSpeed = maxSimulatedSpeed * Math.sin(progress * Math.PI / 2);
                    const fluctuation = (Math.random() - 0.5) * 5; // Fluktuasi kecil
                    simulatedSpeed = Math.max(0, targetSpeed + fluctuation);

                    const angle = speedToAngle(simulatedSpeed);
                    if (needle) needle.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                    if (speedDisplay) speedDisplay.textContent = `${formatSpeed(simulatedSpeed)}`;
                }, updateInterval);
            });
        }

        async function startSpeedTest() {
            if (startButton.disabled) return;
            
            const pingResult = document.getElementById('ping-result');
            const downloadResult = document.getElementById('download-result');
            const uploadResult = document.getElementById('upload-result');

            startButton.disabled = true;
            startButton.innerHTML = '<span class="spinner mr-2"></span> Menguji...';
            
            pingResult.textContent = '--';
            downloadResult.textContent = '--';
            uploadResult.textContent = '--';

            // 1. Tes Ping
            const ping = await measurePing();
            pingResult.textContent = `${ping.toFixed(0)}`;
            await new Promise(resolve => setTimeout(resolve, 500));

            // 2. Tes Download
            const downloadSpeed = await measureThroughput('download');
            downloadResult.textContent = `${formatSpeed(downloadSpeed)}`;

            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 3. Tes Upload
            const uploadSpeed = await measureThroughput('upload');
            uploadResult.textContent = `${formatSpeed(uploadSpeed)}`;

            if (statusText) statusText.textContent = "Tes Selesai! Hasil di atas adalah simulasi.";
            if (startButton) {
                startButton.innerHTML = '<i data-lucide="refresh-cw" class="w-6 h-6 mr-3"></i> Ulangi Tes';
                startButton.disabled = false;
            }
            if (needle) needle.style.transform = 'translateX(-50%) rotate(-90deg)';
            lucide.createIcons();
        }

        // ======================================================
        // SPEAKER TESTER FUNCTIONS
        // ======================================================

        let audioContext = null;
        let oscillator = null;
        let panner = null;
        const buttonIds = ['test-left', 'test-right', 'test-stereo'];

        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function stopSpeakerTest() {
            if (oscillator) {
                oscillator.stop();
                oscillator.disconnect();
                oscillator = null;
            }
            if (panner) {
                panner.disconnect();
                panner = null;
            }
            
            document.getElementById('speaker-status').innerHTML = '<span class="text-gray-700">Tes dihentikan. Tekan tombol untuk memulai lagi.</span>';
            document.getElementById('stop-audio').style.display = 'none';
            
            // Aktifkan kembali SEMUA tombol
            buttonIds.forEach(id => {
                const button = document.getElementById(id);
                if (button) button.disabled = false;
            });
            lucide.createIcons();
        }

        function startSpeakerTest(channel) {
            stopSpeakerTest();

            const ctx = getAudioContext();
            const statusEl = document.getElementById('speaker-status');
            const stopButton = document.getElementById('stop-audio');
            
            // Nonaktifkan semua tombol segera
            buttonIds.forEach(id => {
                const button = document.getElementById(id);
                if (button) button.disabled = true;
            });

            try {
                
                oscillator = ctx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, ctx.currentTime);

                panner = ctx.createStereoPanner ? ctx.createStereoPanner() : ctx.createPanner();

                let panValue = 0;
                let statusText = '<span class="text-accent-green">Memutar suara di kedua speaker (Stereo).</span>';

                if (channel === 'left') {
                    panValue = -1;
                    statusText = '<span class="text-primary-blue">üîä Memutar suara di speaker **KIRI**. Anda seharusnya hanya mendengar suara dari speaker kiri.</span>';
                } else if (channel === 'right') {
                    panValue = 1;
                    statusText = '<span class="text-accent-red">üîä Memutar suara di speaker **KANAN**. Anda seharusnya hanya mendengar suara dari speaker kanan.</span>';
                }

                if (panner.pan) {
                    panner.pan.setValueAtTime(panValue, ctx.currentTime);
                } else {
                    // Fallback for older PannerNode
                    panner.setPosition(panValue, 0, 0); 
                }
                
                oscillator.connect(panner);
                panner.connect(ctx.destination);
                oscillator.start();

                statusEl.innerHTML = statusText;
                stopButton.style.display = 'block';

                // Nonaktifkan tombol yang sedang aktif
                const currentButton = document.getElementById(`test-${channel}`);
                if (currentButton) currentButton.disabled = true;
                
            } catch (error) {
                statusEl.innerHTML = `<span class="text-accent-red">Gagal memulai tes audio: ${error.message}. Pastikan browser mendukung Web Audio API.</span>`;
                stopButton.style.display = 'none';
                console.error('Web Audio API error:', error);
                // Pastikan mengaktifkan kembali semua tombol jika gagal
                stopSpeakerTest();
            }
            lucide.createIcons();
        }
        
        // ======================================================
        // MONITOR TESTER FUNCTIONS
        // ======================================================
        const monitorTests = [
            { name: "Hitam Solid", color: 'black', text: 'Cek Piksel Terang (Stuck Pixels)' },
            { name: "Putih Solid", color: 'white', text: 'Cek Piksel Gelap (Dead Pixels)', textClass: 'monitor-black-text' },
            { name: "Merah Solid", color: 'red', text: 'Cek Subpiksel Merah' },
            { name: "Hijau Solid", color: 'lime', text: 'Cek Subpiksel Hijau' },
            { name: "Biru Solid", color: 'blue', text: 'Cek Subpiksel Biru' },
            { name: "Keseragaman Abu-abu (50%)", color: '#808080', text: 'Cek Keseragaman Warna/Kecerahan', textClass: 'monitor-black-text' },
            { name: "Gradien Abu-abu", color: 'transparent', isGradient: 'grayscale', text: 'Cek Gradien Abu-abu (Banding)', textClass: 'monitor-black-text' },
            { name: "Gradien Warna Penuh", color: 'transparent', isGradient: 'color', text: 'Cek Transisi Warna & Banding' },
            { name: "Selesai", color: '#3b82f6', text: 'Tes Selesai. Tekan Selesai atau ESC untuk kembali.' }
        ];

        let monitorCurrentTestIndex = -1;
        let monitorTestArea, monitorTestContent, monitorGradientBox, monitorTestInfo, monitorContentContainer;

        function monitorInitTest() {
            monitorTestArea = document.getElementById('monitor-test-area');
            monitorTestContent = document.getElementById('monitor-test-content');
            monitorGradientBox = document.getElementById('monitor-gradient-box');
            monitorTestInfo = document.getElementById('monitor-test-info');
            monitorContentContainer = document.getElementById('monitor-content');
            
            monitorCurrentTestIndex = -1; 
            
            monitorTestArea.style.backgroundColor = 'black';
            monitorTestArea.style.color = 'white';
            monitorTestArea.classList.remove('color-test', 'monitor-black-text');
            monitorTestContent.style.display = 'block';
            monitorGradientBox.style.display = 'none';
            monitorTestContent.textContent = 'Klik atau Tekan Tombol Panah Kanan (‚Üí) untuk memulai!';
            monitorTestInfo.textContent = `Persiapan (0/${monitorTests.length})`;
        }

        function monitorApplyTest(index) {
            if (index < 0 || index >= monitorTests.length) {
                if (index >= monitorTests.length) {
                    // Ketika selesai, kembali ke tab keyboard
                    setActiveTab('keyboard'); 
                    return;
                }
                monitorInitTest();
                return;
            }

            const test = monitorTests[index];
            
            monitorTestArea.style.backgroundColor = test.color;
            monitorTestArea.classList.remove('color-test', 'monitor-black-text');
            monitorTestArea.style.color = 'white'; 
            monitorTestContent.style.display = 'block';
            monitorGradientBox.style.display = 'none';

            if (test.textClass) {
                monitorTestArea.classList.add(test.textClass);
                monitorTestArea.style.color = 'black'; 
            }

            if (test.isGradient) {
                monitorTestArea.style.backgroundColor = 'white';
                monitorTestArea.style.color = 'black'; 
                monitorTestContent.style.display = 'none';
                monitorGradientBox.style.display = 'block';

                if (test.isGradient === 'color') {
                    monitorTestArea.classList.add('color-test');
                }
            }

            monitorTestContent.textContent = test.text;
            monitorTestInfo.textContent = `${test.name} (${index + 1}/${monitorTests.length})`;
            monitorCurrentTestIndex = index;
        }

        function monitorNextTest() {
            monitorApplyTest(monitorCurrentTestIndex + 1);
        }

        function monitorPrevTest() {
            if (monitorCurrentTestIndex > 0) {
                monitorApplyTest(monitorCurrentTestIndex - 1);
            } else if (monitorCurrentTestIndex === 0) {
                monitorInitTest();
            }
        }
        
        function toggleFullScreen() {
            if (!monitorContentContainer) {
                monitorContentContainer = document.getElementById('monitor-content');
            }
            
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                if (monitorContentContainer.requestFullscreen) {
                    monitorContentContainer.requestFullscreen();
                } else if (monitorContentContainer.mozRequestFullScreen) {
                    monitorContentContainer.mozRequestFullScreen();
                } else if (monitorContentContainer.webkitRequestFullscreen) {
                    monitorContentContainer.webkitRequestFullscreen();
                } else if (monitorContentContainer.msRequestFullscreen) {
                    monitorContentContainer.msRequestFullscreen();
                }
            }
        }

        // ======================================================
        // INITIALIZATION
        // ======================================================
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Setup Listeners untuk Monitor Tester
            document.getElementById('monitor-test-area').addEventListener('click', monitorNextTest);
            document.getElementById('monitor-next-btn').addEventListener('click', monitorNextTest);
            document.getElementById('monitor-prev-btn').addEventListener('click', monitorPrevTest);
            
            // Inisialisasi awal
            setActiveTab('keyboard'); 
        });

    </script>
</body>
</html>
